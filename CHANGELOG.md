# 更新日志

## [2.1.0] - 2026-02-21

### ✨ 历史详情/删除、退出考试、注册显示名称

#### 新功能

1. **历史记录 — View Details（查看详情）**
   - 每条历史记录新增 "View Details" 按钮
   - 点击后进入专属详情页面，显示：
     - 考试日期、总分、正确/错误/未答/准确率/用时摘要
     - 三档题目（Q1–8 / Q9–16 / Q17–24）的 ✓/✗ 得分表格
     - 逐题作答明细：高亮正确答案（绿色）和用户的错误答案（红色）

2. **历史记录 — Delete（删除）**
   - 每条历史记录新增 "Delete" 按钮
   - 二次确认后从 Supabase 删除该条记录，自动刷新列表

3. **考试中 — Quit Test（退出考试）**
   - 考试侧边栏 Submit Test 按钮下方新增红色 "Quit Test" 按钮
   - 弹出确认框，确认后清除计时器、重置状态，返回初始页面
   - 不计入 Exam History

4. **注册 — 自定义显示名称**
   - 注册表单新增 "Display Name" 输入项（必填）
   - 名称存储至 Supabase `user_metadata.display_name`
   - 登录后导航栏显示自定义名称而非邮箱
   - 已有账户（无 display_name）自动降级显示邮箱，向下兼容

#### 题库更新

- 删除题目 `AT-BEN-14-13`（4分题），题库由 343 题减至 342 题

#### 技术说明

- 新增 `history-detail-screen` 页面
- 新增 `showHistoryDetail()`、`deleteHistoryRecord()`、`quitTest()` 函数
- `state` 新增 `historyData` 缓存字段
- CSS 新增 `.btn-danger`、`.history-item-actions` 样式

---

## [2.0.0] - 2026-02-19

### 🚀 用户系统上线（Supabase 云端后端）

#### 新功能

1. **用户注册 / 登录**
   - 邮箱 + 密码注册，无需邮箱验证，注册即可使用
   - 顶部导航栏：未登录显示 Log In / Sign Up；登录后显示用户邮箱及功能按钮
   - 弹窗式 Auth Modal，包含登录、注册、忘记密码、修改密码四个面板
   - Enter 键快捷提交表单

2. **密码重置**
   - 点击"Forgot password?" 输入邮箱，Supabase 自动发送重置邮件
   - 用户点击邮件链接跳转回网站，显示专属 Recovery 页面设置新密码
   - 完成后自动清除 URL hash，跳转回首页

3. **修改密码**
   - 登录状态下点击导航栏"Change Password"，在弹窗中直接修改

4. **历史考试记录**
   - 登录用户每次提交考试后自动保存：分数、正确/错误/未答数、准确率、用时
   - 导航栏"History"按钮进入历史页面，按时间倒序显示所有考试
   - 成绩按高低着色（≥80% 绿色，≥60% 橙色，<60% 红色）

5. **题目收藏**
   - 考试中：题目操作栏新增 ☆ Favorite 按钮，点击收藏/取消收藏
   - 答题详解中：每题右上角有 ☆ Favorite 按钮
   - 游客点击收藏会提示"Please log in"
   - 导航栏"Favorites"进入收藏页面，可点击"Show Answer"展示正确答案（绿色高亮）
   - 支持"Remove"从收藏中删除

6. **智能题目生成（防重复）**
   - 登录用户每次出题，按 3/4/5 分三个难度分别从未做过的题目中随机选取
   - 某难度所有题目用完后自动开始新一轮，题目重新可用
   - 题目进度保存至云端，换设备登录也能延续进度
   - 游客仍使用原有完全随机模式

7. **游客模式保留**
   - 未登录可直接考试，所有考试功能正常使用
   - 历史记录和收藏功能需要登录

#### 技术架构

- **后端**：Supabase（PostgreSQL + Auth）
- **数据库表**：`exam_results`、`favorites`、`question_progress`
- **安全**：Row Level Security (RLS) 确保用户只能访问自己的数据
- **前端**：通过 Supabase JS SDK（UMD CDN）直连数据库，无需服务器

#### Bug 修复

- 修复 CDN 加载路径（改为明确的 UMD 构建路径）
- 修复 Supabase 客户端变量名与 CDN 全局变量 `supabase` 冲突导致的 `SyntaxError`（重命名为 `db`）
- 修复 CDN 加载失败时整个脚本崩溃的问题（防御性初始化）

---

## [1.5.0] - 2026-02-19

### ✨ 计时暂停 + 结果分组表格

#### 新功能

1. **计时暂停按钮**
   - 考试 Header 中计时器旁新增 ⏸ Pause 按钮
   - 暂停时：计时停止，全屏遮罩覆盖题目内容，显示"Test Paused"和恢复按钮
   - 恢复时：计时继续，遮罩消失
   - 提交考试时若处于暂停状态自动恢复正常

2. **结果分组统计表格**
   - 成绩页 4 个统计数字下方新增 3 张表格（Q1–8 / Q9–16 / Q17–24）
   - 每张表第一行为题号，第二行为结果：✓ 绿色（正确）/ ✗ 红色（错误/未答）

---

## [1.4.0] - 2026-02-11

### 🎯 页面隔离和显示修复

#### 修复的关键问题
1. **提交测试后的页面混乱**
   - 问题：点击Submit Test后，题目内容和左侧题号列表仍然显示，需要下拉才能看到结果
   - 原因：不同screen之间没有正确隔离，多个screen内容同时可见
   - 修复：强化CSS隔离（使用!important），确保只有active的screen显示

2. **查看答案时的页面混乱**
   - 问题：点击View Detailed Answers后，还显示之前的题目内容，需要下拉
   - 修复：确保review-screen激活时，test-screen完全隐藏

3. **重新开始测试的问题**
   - 问题：点击Take New Test后，开始新测试，上一次的结果还显示在题目下方
   - 修复：确保welcome-screen和test-screen激活时，results-screen完全隐藏

4. **页面切换滚动问题**
   - 问题：页面切换时可能停留在之前的滚动位置
   - 修复：在showScreen函数中立即滚动到顶部（window.scrollTo(0, 0)）

#### 新功能
5. **悬浮的"Back to Results"按钮**
   - 位置：固定在页面右上角（position: fixed）
   - 优点：在答案解析的任何位置都可以快速返回结果页
   - 样式：蓝色背景，悬停效果，响应式设计
   - 移动端适配：自动调整大小和位置

#### 技术改进
- CSS `.screen` 规则：添加 `!important` 强制隔离
- `showScreen()` 函数：先滚动到顶部，再切换screen，强制reflow
- `submitTest()` 函数：先滚动，再切换页面
- `showReview()` 函数：先滚动，再渲染内容
- 移除了不必要的 `scrollToTop()` 调用（功能合并到showScreen中）
- 响应式设计：悬浮按钮在移动设备上自动缩小

---

## [1.3.0] - 2026-02-11

### 🎯 页面布局和显示优化

#### 修复的问题
1. **结果页面显示问题**
   - 问题：点击Submit Test后，页面内容不在视口内，需要滚动才能看到分数
   - 修复：移除flex居中布局，让结果内容从页面顶部开始显示
   - 修复：立即滚动到顶部，确保内容可见

2. **答案解析页面显示问题**
   - 问题：点击View Detailed Answers后，内容可能不在视口内
   - 修复：优化页面布局，确保内容从顶部显示

3. **页面切换一致性**
   - 问题：不同页面的布局方式不一致
   - 修复：统一所有页面的布局方式，移除不必要的居中布局

#### 技术改进
- 修改 `#results-screen` 布局：移除flex居中，使用标准流布局
- 修改 `#review-screen` 布局：确保min-height设置
- 修改 `#welcome-screen` 布局：与其他页面保持一致
- 优化 `scrollToTop()` 函数：立即滚动+平滑滚动组合
- 强化 `showScreen()` 函数：确保正确的显示/隐藏

---

## [1.2.0] - 2026-02-11 14:15

### 🎯 页面切换滚动优化

#### 修复的问题
1. **提交试卷后的滚动问题**
   - 问题：点击Submit后，需要下拉才能看到得分信息
   - 修复：自动滚动到结果页面顶部，得分信息立即可见

2. **重新开始测试的滚动问题**
   - 问题：点击Take New Test后，停留在底部，需要上拉看到欢迎页面
   - 修复：自动滚动到欢迎页面顶部，Test Information立即可见

3. **查看答案解析的滚动问题**
   - 问题：可能停留在之前位置
   - 修复：自动滚动到答案解析页面顶部

4. **返回结果页的滚动问题**
   - 问题：可能停留在答案解析的位置
   - 修复：自动滚动到结果页面顶部

#### 技术改进
- 新增 `scrollToTop()` 统一函数
- 所有页面切换操作都自动滚动到顶部
- 保持平滑滚动动画

---

## [1.1.0] - 2026-02-11 13:09

### 🎯 题目导航滚动优化

#### 修复的问题
1. **开始测试后的滚动问题**
   - 问题：点击Start Test后，需要下拉才能看到题目
   - 修复：自动滚动到题目内容区域

2. **点击Next/Previous的滚动问题**
   - 问题：页面跳到顶部，需要下拉看下一题
   - 修复：自动滚动到题目内容

3. **点击题号导航的滚动问题**
   - 修复：自动滚动到选中的题目

#### 技术改进
- 新增 `scrollToQuestion()` 统一函数
- 添加 CSS `scroll-margin-top` 属性
- 响应式设计适配移动设备

---

## [1.0.0] - 2026-02-11 12:00

### 🎉 初始版本发布

#### 核心功能
- ✅ 24题测试系统（3pts×8 + 4pts×8 + 5pts×8）
- ✅ 60分钟倒计时
- ✅ 题目顺序：1-8题3分，9-16题4分，17-24题5分
- ✅ 图片支持（185题包含图片）
- ✅ 标记题目功能
- ✅ 自动评分系统
- ✅ 详细答案解析
- ✅ 响应式设计

#### 数据
- 总题库：343题
- 3分题：104题
- 4分题：112题
- 5分题：127题

#### 技术栈
- 纯HTML/CSS/JavaScript
- 无需服务器端
- 无需数据库
- 本地运行

---

## 版本说明

- **主版本号**：重大功能更新
- **次版本号**：新功能添加
- **修订号**：Bug修复和小改进
